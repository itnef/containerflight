#!/usr/local/bin/containerflight run
version: 0.x

docker:
    dockerfile: |
        FROM ubuntu:16.04

        ENV http_proxy=${ENV:http_proxy}
        ENV https_proxy=${ENV:https_proxy}

        RUN apt-get update && \
            export DEBIAN_FRONTEND=noninteractive && \
            apt-get install -y software-properties-common && \
            rm -rf /var/lib/apt/lists/*

        RUN add-apt-repository ppa:hugin/hugin-builds && \
            apt-get update && \
            export DEBIAN_FRONTEND=noninteractive && \
            apt-get install -y hugin enblend && \
            rm -rf /var/lib/apt/lists/*

        # set-up the host user/group environment 
        RUN set -x ; \
            groupadd -g ${GROUPID} ${GROUPNAME} ; \
            adduser --uid ${USERID} --gid ${USERID} ${USERNAME} && exit 0 ; exit 1

        USER ${USERNAME}

        ENTRYPOINT "/usr/bin/hugin"

    runargs: [
        "-ti",
        "--rm",
        "-a", "stdin",
        "-a", "stdout",
		"-v", "${PWD}:${PWD}",
		"-e", "DISPLAY=${ENV:DISPLAY}",
        "-v", "/dev:/dev",
		"-v", "/tmp/.X11-unix:/tmp/.X11-unix",
		"-w", "${PWD}",
        "--privileged"
    ]
