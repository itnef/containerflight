#!/usr/local/bin/containerflight run
version: 0.x

docker:
    dockerfile: |
        FROM ubuntu:16.04

        ENV http_proxy=${ENV:http_proxy}
        ENV https_proxy=${ENV:https_proxy}

        # TODO: way too many deps
        RUN apt-get update && \
            export DEBIAN_FRONTEND=noninteractive && \
            apt-get install -y bzip2 curl openjdk-8-jdk gnome-shell && \
            rm -rf /var/lib/apt/lists/*

        RUN mkdir -p /opt && \
            curl http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/technology/epp/downloads/release/oxygen/2/eclipse-dsl-oxygen-2-linux-gtk-x86_64.tar.gz \
            | tar -xzC /opt
        
        # set-up the host user/group environment 
        RUN set -x ; \
            groupadd -g ${GROUPID} ${GROUPNAME} ; \
            adduser --uid ${USERID} --gid ${USERID} ${USERNAME} && exit 0 ; exit 1

        USER ${USERNAME}

        ENTRYPOINT [ "/opt/eclipse/eclipse" ]

    runargs: [
        "-v", "${HOME}:${HOME}",
        "-v", "${PWD}:${PWD}",
        "-e", "DISPLAY=${ENV:DISPLAY}",
		"-v", "/tmp/.X11-unix:/tmp/.X11-unix",
		"-w", "${PWD}"
    ]